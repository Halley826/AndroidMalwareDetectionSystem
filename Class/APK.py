from androguard.misc import AnalyzeAPK
import numpy as np
import pandas as pd
#!/usr/bin/env python
# _*_ coding: utf-8 _*_
# @Time : 2021/12/27 10:01 PM
# @Author : Halley@https://github.com/Halley826/
# @Version：V 1.0
# @File : test.py
# @desc :Apk相关的功能，反编译APK文件并生成特征向量
class APK:

    def __init__(self,apk_dir,permissions_txt_dir):
        self.dir=apk_dir
        self.permissions_txt=permissions_txt_dir
    def decode(self):#反编译
        global a, d, dx
        a, d, dx = AnalyzeAPK(self.dir)
        print("{} is ok".format(self.dir))
    def permissionTxtToList(self):#将txt转化为list
        permission_list_all=[]
        with open(self.permissions_txt) as f:
            for line in f:
                for i in line.split():
                    permission_list_all.append(i)
        return permission_list_all
    def permissionListToNpy(self):
        np.save("./out/permission",self.permissionTxtToList())
    def permissionGet(self):#获取特征
        return a.get_permissions()
    def apiGet(self):
        pass
    def permissionVectorGet(self,list1,list2):#list1特征空间
        list3=np.zeros(len(list1),dtype= np.int)
        #     print("type of list3:{}".format(type(list3)))
        i=0
        for list_1 in list1:
            for list_2 in list2:
                if list_1==list_2:
                    list3[i]=1
            i+=1
        #特征向量
        return list3